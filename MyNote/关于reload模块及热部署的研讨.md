# 需求背景
```
1、鉴于目前线上环境与集成测试环境差异较大，集成测试环境镜像包不完善，及相应功能的缺陷。导致开发及运维人员在每次版本迭代过程中，消耗巨量的时间、精力，以及体力
2、现急需一种方法手段，能够使开发及运维人员摆脱传统发版的弊端带来的困扰
3、热部署开始预研
```
# 前言
```
热部署是在项目进程不中断的情况下，动态实现程序加载，鉴于目前平台的APIServer是用Python语言实现，在python2.7中，
内置了reload模块，支持动态加载。热部署完全可以通过reload模块，及简单的调整来实现
```
# reload原理解释
```
在python语言中，核心理念是以模块作为单位，每个以.py结尾的文件都是一个模块，即一个对象，其他文件可以通过导入模块来读取该模块的内容，更多的模块互相引用，实现了整个程序的运行。
reload模块，即是实现对某一模块的重新加载
```
一、默认情况下，模块在第一次被导入后，其他的导入都不再生效。即import只会执行一次
```
第一次执行import，会去读取module中的代码，并将其编译为字节码，而后保存在内存中，下次再import时，
只是去内存中sys.module中查找是否存在对应的模块对象，而并没有去读源module本身
```
```
示例展示：
1）先创建一个test.py文件
>>>def test():
>>>    print("PaaS")
2）导入这个模块，并打印
>>>import test
>>>test.test()
PaaS
3）修改源模块
>>>def test():
>>>    print("PaaS..........")
4）再次导入模块，并打印函数
>>>import test
>>>test.test()
PaaS
我们发现，即使修改了源文件，但打印出的结果依旧没有改变，即说明import第二次执行时，并没有加载，而是直接读取的内存，上述论断得到印证，
理解这里对reload的实现很重要
这样设计的原因在于，导入是一个开销很大的动作，要经过 找到文件 --> 编译成字节码 --> 运行,
所以每个文件、每个程序运行不能够重复多于一次
```
二、reload模块，原理是强制python解释器重读源module，并重编字节码
```
>>>import test
>>>test.test()
PaaS
>>>reload(test)
<module 'test' from 'test.py'>
>>>test.test()
PaaS..........
我们看到，reload重新加载后，修改后的内容生效了
```
三、reload的说明
```
# 模块会被重新解释为字节码。并在模块内定义一个新的 命名 -> 新对象 的命名空间映射
# 模块reload前的所有旧对象，直到它们的引用数量降到0,才能被gc回收
# 模块的命名空间中的命名全部指向了新的对象
# 其他模块中对模块reload前的旧对象的引用，仍然维持就对象的引用
# 重新加载的模块不删除最初旧版本模块在符号表中的登记项
```
四、reload的执行流程
```
1> 在sys.modules中查找到对应模块名的模块对象
2> 针对该模块名的 执行文件 属性，找到对应文件并重新编译该文件执行
3> 将代码执行中产生的对象依次更新到原模块对象的属性中
```
五、重点事项：（我会展开分支详细说明）
```
1> import和from...import...差异很大，reload只能使用import
2> reload不具有传递性
```






